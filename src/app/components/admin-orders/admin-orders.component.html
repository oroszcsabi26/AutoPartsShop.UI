<div class="admin-container">
    <h1>ğŸ“¦ RendelÃ©sek kezelÃ©se</h1>

    <div class="search-bar">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          (input)="loadOrders()"
          placeholder="ğŸ” KeresÃ©s a megrendelÅ‘ neve alapjÃ¡n..." />
      </div>

    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

    <ul class="order-list">
        <li *ngFor="let order of orders">
            <div class="order-header">
                <strong> RendelÃ©s #{{ order.id }}</strong>
            </div>
            <div class="order-status-control">
                <label for="statusSelect">ğŸ“ StÃ¡tusz:</label>
                    <select 
                    [id]="'statusSelect_' + order.id"
                    [(ngModel)]="selectedStatusMap[order.id]"
                    (change)="updateStatus(order.id)">
                        <option *ngFor="let status of orderStatuses" [value]="status.key">
                            {{ status.label }}
                        </option>
                    </select>
                <!-- âœ… Sikeres frissÃ­tÃ©s Ã¼zenet -->
                <div *ngIf="statusUpdateMessageMap[order.id]" class="status-message">
                {{ statusUpdateMessageMap[order.id] }}
                </div>
            </div>
            <div class="order-info">
                <p><strong>FelhasznÃ¡lÃ³:</strong> {{ order.user.firstName }} {{ order.user.lastName }}</p>
                <p><strong>Email:</strong> {{ order.user.email }}</p>
                <p><strong>TelefonszÃ¡m:</strong> {{ order.user.phoneNumber }}</p>
                <p><strong>SzÃ¡llÃ­tÃ¡si cÃ­m:</strong> {{ order.shippingAddress }}</p>
                <p><strong>SzÃ¡mlÃ¡zÃ¡si cÃ­m:</strong> {{ order.billingAddress }}</p>
                <p><strong>RendelÃ©s ideje:</strong> {{ order.orderDate | date:'yyyy-MM-dd HH:mm' }}</p>
            </div>
            <div class="order-items">
                <p><strong>TermÃ©kek:</strong></p>
                <ul>
                    <li *ngFor="let item of order.orderItems">
                        {{ item.name }} - {{ item.quantity }} db - {{ item.price * item.quantity }} Ft
                    </li>
                </ul>
            </div>
            <div class="order-actions">
                <button class="delete" (click)="openDeleteModal(order)">ğŸ—‘ï¸ TÃ¶rlÃ©s</button>
            </div>
        </li>
    </ul>

    <!-- TÃ¶rlÃ©s megerÅ‘sÃ­tÅ‘ modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <p>Biztosan tÃ¶rÃ¶lni szeretnÃ©d ezt a rendelÃ©st?</p>
            <button class="confirm" (click)="confirmDelete()">âœ… Igen</button>
            <button class="cancel" (click)="closeDeleteModal()">âŒ MÃ©gse</button>
        </div>
    </div>
</div>
